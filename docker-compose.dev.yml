# Development overrides for docker-compose
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  backend:
    # Override command to enable auto-reload
    command: ["uvicorn", "backend.src.api.routes:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
    environment:
      # Development-specific environment variables
      DEBUG: "true"
      LOG_LEVEL: debug
    volumes:
      # Additional volume mounts for development
      - ./backend:/app/backend:delegated
      - ./data:/app/data:delegated
      - ./config:/app/config:delegated

  ui:
    # Streamlit already supports hot reload by default
    environment:
      # Development-specific environment variables
      DEBUG: "true"
      STREAMLIT_LOGGER_LEVEL: debug
    volumes:
      # Ensure UI code changes are reflected immediately
      - ./ui:/app/ui:delegated
      - ./.streamlit:/app/.streamlit:delegated

  postgres:
    # Expose additional ports for direct database access during development
    ports:
      - "5432:5432"
    # Mount additional scripts for development
    volumes:      
      - ./scripts/init-db.dump:/docker-entrypoint-initdb.d/init-db.dump
      - ./scripts/01-restore-db.sh:/docker-entrypoint-initdb.d/01-restore-db.sh

  ollama:
    # Keep data persistent across restarts
    volumes:
      - ollama_data:/root/.ollama

volumes:
  postgres_data:
  ollama_data:
